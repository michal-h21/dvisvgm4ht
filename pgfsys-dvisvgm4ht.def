% Copyright 2006 by Till Tantau
%
% This file may be distributed and/or modified
%
% 1. under the LaTeX Project Public License and/or
% 2. under the GNU Public License.
%
% See the file doc/generic/pgf/licenses/LICENSE for more details.


% Driver commands for tex4ht

%
% Load common pdf commands:
%
  %\input pgfsys-dvisvgm.def
  \input pgfsys-dvips.def

%
% tex4ht-specific stuff:
%

\newcount\pgf@sys@svg@picnum

% configure the output picture format to svg
\AtBeginDocument{
  \Configure{Picture}{.svg}
  \def\pgfsys@beginpicture{%
    \bgroup%
    \csname a:tikzpicture\endcsname% insert tex4ht start hook
    \orig@pgfsys@begin% run the dvips driver code
  }%
  \def\pgfsys@endpicture{%
    \orig@pgfsys@end% run closing original driver code
    \csname b:tikzpicture\endcsname% insert tex4ht finishing hook
    \egroup%
    \par%
  }%
}


% Make the code inserted by tex4ht configurable

\NewConfigure{tikzpicture}{2}
\Configure{tikzpicture}{%
  \protect\csname nested:math\endcsname% support display math
  \ifvmode\def\run@pict@cmd{\Picture*}\else\def\run@pict@cmd{\Picture+}\fi% different variants of \Picture needs to be used, depending on the vertical mode
  \ifdefined\Picture\run@pict@cmd\fi% it requires conversion of the enclosed content to images by tex4ht
}{\ifdefined\EndPicture\EndPicture\fi}

\let\orig@pgfsys@begin\pgfsys@beginpicture
\let\orig@pgfsys@end\pgfsys@endpicture
\def\pgf@sys@postscript@header#1{{\special{! #1}}}


\endinput


%%% Local Variables: 
%%% mode: latex
%%% End: 
